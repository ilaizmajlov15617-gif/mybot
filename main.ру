import telebot
from telebot import types
import random

# --- –ù–ê–°–¢–†–û–ô–ö–ò ---
TOKEN = '8352938832:AAGooh41WdnQgmcqNxBzYSnC1QvqMpeCqBg'
CHANNEL_ID = '@swag40444' 
ADMIN_ID = 875740812

bot = telebot.TeleBot(TOKEN)

# --- –ë–ê–ó–ê –ö–ê–¢–ï–ì–û–†–ò–ô ---
data_storage = {
    "üé§ –†–ï–ü–ï–†–´": {
        "–ü–ª–∞—Ç–∏–Ω–∞": "–†–æ–±–µ—Ä—Ç –ü–ª–∞—É–¥–∏—Å", "OG Buda": "–ì—Ä–∏–≥–æ—Ä–∏–π –õ—è—Ö–æ–≤", "Mayot": "–ê—Ä—Ç–µ–º –ù–∏–∫–∏—Ç–∏–Ω",
        "Toxi$": "–ê–Ω–¥—Ä–µ–π –°–º–µ–ª—è–Ω—Å–∫–∏–π", "Big Baby Tape": "–ï–≥–æ—Ä –†–∞–∫–∏—Ç–∏–Ω"
    },
    "üõ† –°–¢–†–û–ô–ö–ê": {
        "–ë–æ–ª–≥–∞—Ä–∫–∞": "–ü–∏–ª–∏—Ç –º–µ—Ç–∞–ª–ª, –∏—Å–∫—Ä—ã –≤–æ –≤—Å–µ —Å—Ç–æ—Ä–æ–Ω—ã",
        "–ü–µ—Ä—Ñ–æ—Ä–∞—Ç–æ—Ä": "–ì–ª–∞–≤–Ω—ã–π –≤—Ä–∞–≥ —Å–æ—Å–µ–¥–µ–π –≤ 8 —É—Ç—Ä–∞",
        "–®—É—Ä—É–ø–æ–≤–µ—Ä—Ç": "–ö—Ä—É—Ç–∏—Ç —Å–∞–º–æ—Ä–µ–∑—ã, –Ω–∞ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–µ"
    },
    "üöó –ú–ê–®–ò–ù–´": {
        "BMW": "–ü–∞—Ü–∞–Ω—Å–∫–∞—è –∫–ª–∞—Å—Å–∏–∫–∞, –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –≤–∏–¥",
        "Mercedes": "–ö–æ–º—Ñ–æ—Ä—Ç, —Å—Ç–∞—Ç—É—Å, –ø–ª–∞–≤–Ω—ã–π —Ö–æ–¥",
        "Toyota Camry": "–õ–µ–≥–µ–Ω–¥–∞ 3.5, –≤–µ—á–Ω—ã–π –¥–≤–∏–≥–∞—Ç–µ–ª—å"
    },
    "üéÆ –ò–ì–†–´": {
        "Minecraft": "–ö—É–±—ã, –∫–∏—Ä–∫–∞ –∏ –∫—Ä–∏–ø–µ—Ä—ã",
        "CS:GO": "–ö–æ–Ω—Ç—Ä—ã, —Ç–µ—Ä—Ä—ã –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞—á–∫–∏",
        "Dota 2": "–ú–∏–¥, –∫—É—Ä—å–µ—Ä –∏ —Å–ª–æ–º–∞–Ω–Ω—ã–π —Ç—Ä–æ–Ω"
    },
    "ü•ò –ï–î–ê": {
        "–®–∞—É—Ä–º–∞": "–ú—è—Å–æ –≤ –ª–∞–≤–∞—à–µ, –º–Ω–æ–≥–æ —Å–æ—É—Å–∞ –∏ –æ–≤–æ—â–µ–π",
        "–ü–∏—Ü—Ü–∞": "–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π –∫—Ä—É–≥ —Å—á–∞—Å—Ç—å—è —Å —Å—ã—Ä–æ–º",
        "–ë–æ—Ä—â": "–ö—Ä–∞—Å–Ω—ã–π —Å—É–ø, –ª—É—á—à–µ –≤—Å–µ–≥–æ —Å–æ —Å–º–µ—Ç–∞–Ω–æ–π"
    }
}

settings = {"welcome_text": "–ß—Ç–æ–±—ã –¥–≤–∏–≥–∞—Ç—å—Å—è —Å –Ω–∞–º–∏, –ø–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª –ø–∞—Ü–∞–Ω–æ–≤!"}
game_data = {}

def check_subscribe(user_id):
    try:
        status = bot.get_chat_member(CHANNEL_ID, user_id).status
        return status in ['member', 'administrator', 'creator']
    except:
        return False

@bot.message_handler(commands=['start'])
def start(message):
    if check_subscribe(message.from_user.id):
        show_player_count(message.chat.id)
    else:
        markup = types.InlineKeyboardMarkup()
        markup.add(types.InlineKeyboardButton("–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è", url="https://t.me/swag40444"))
        markup.add(types.InlineKeyboardButton("–Ø –ø–æ–¥–ø–∏—Å–∞–ª—Å—è ‚úÖ", callback_data="check_sub"))
        bot.send_message(message.chat.id, settings["welcome_text"], reply_markup=markup)

@bot.callback_query_handler(func=lambda call: call.data == "check_sub")
def sub_check(call):
    if check_subscribe(call.from_user.id):
        try:
            bot.delete_message(call.message.chat.id, call.message.message_id)
        except:
            pass
        show_player_count(call.message.chat.id)
    else:
        bot.answer_callback_query(call.id, "–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–ø–∏—à–∏—Å—å!", show_alert=True)

def show_player_count(chat_id):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, one_time_keyboard=True)
    markup.add("3", "4", "5", "6")
    bot.send_message(chat_id, "–°–∫–æ–ª—å–∫–æ —á–µ–ª–æ–≤–µ–∫ –∏–≥—Ä–∞–µ—Ç?", reply_markup=markup)

@bot.message_handler(func=lambda m: m.text in ["3", "4", "5", "6"])
def select_category(message):
    game_data[message.chat.id] = {"count": int(message.text), "current": 1}
    markup = types.InlineKeyboardMarkup()
    for cat in data_storage.keys():
        markup.add(types.InlineKeyboardButton(cat, callback_data=f"cat_{cat}"))
    bot.send_message(message.chat.id, "–í—ã–±–µ—Ä–∏ —Ç–µ–º–∞—Ç–∏–∫—É —Ä–∞—É–Ω–¥–∞:", reply_markup=markup)

@bot.callback_query_handler(func=lambda call: call.data.startswith("cat_"))
def start_game(call):
    category_name = call.data.replace("cat_", "")
    chat_id = call.message.chat.id
    word = random.choice(list(data_storage[category_name].keys()))
    desc = data_storage[category_name][word]
    game_data[chat_id].update({
        "mafia_index": random.randint(1, game_data[chat_id]["count"]),
        "word": word,
        "desc": desc,
        "category": category_name
    })
    bot.delete_message(chat_id, call.message.message_id)
    send_turn(chat_id)

def send_turn(chat_id):
    data = game_data[chat_id]
    markup = types.InlineKeyboardMarkup()
    markup.add(types.InlineKeyboardButton("üëÄ –£–ó–ù–ê–¢–¨ –†–û–õ–¨", callback_data="reveal_role"))
    bot.send_message(chat_id, f"üé≤ –ò–≥—Ä–æ–∫ ‚Ññ{data['current']}, —Ç–≤–æ–π —Ö–æ–¥!", reply_markup=markup)

@bot.callback_query_handler(func=lambda call: call.data == "reveal_role")
def reveal(call):
    chat_id = call.message.chat.id
    data = game_data[chat_id]
    if data["current"] == data["mafia_index"]:
