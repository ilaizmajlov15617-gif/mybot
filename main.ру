bot.delete_message(call.message.chat.id, call.message.message_id)
        except:
            pass
        show_player_count(call.message.chat.id)
    else:
        bot.answer_callback_query(call.id, "–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–ø–∏—à–∏—Å—å!", show_alert=True)

def show_player_count(chat_id):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, one_time_keyboard=True)
    markup.add("3", "4", "5", "6")
    bot.send_message(chat_id, "–°–∫–æ–ª—å–∫–æ —á–µ–ª–æ–≤–µ–∫ –∏–≥—Ä–∞–µ—Ç?", reply_markup=markup)

@bot.message_handler(func=lambda m: m.text in ["3", "4", "5", "6"])
def select_category(message):
    game_data[message.chat.id] = {"count": int(message.text), "current": 1}
    markup = types.InlineKeyboardMarkup()
    for cat in data_storage.keys():
        markup.add(types.InlineKeyboardButton(cat, callback_data=f"cat_{cat}"))
    bot.send_message(message.chat.id, "–í—ã–±–µ—Ä–∏ —Ç–µ–º–∞—Ç–∏–∫—É —Ä–∞—É–Ω–¥–∞:", reply_markup=markup)

@bot.callback_query_handler(func=lambda call: call.data.startswith("cat_"))
def start_game(call):
    category_name = call.data.replace("cat_", "")
    chat_id = call.message.chat.id
    
    word = random.choice(list(data_storage[category_name].keys()))
    desc = data_storage[category_name][word]
    
    game_data[chat_id].update({
        "mafia_index": random.randint(1, game_data[chat_id]["count"]),
        "word": word,
        "desc": desc,
        "category": category_name
    })
    
    bot.delete_message(chat_id, call.message.message_id)
    send_turn(chat_id)

def send_turn(chat_id):
    data = game_data[chat_id]
    markup = types.InlineKeyboardMarkup()
    markup.add(types.InlineKeyboardButton("üëÄ –£–ó–ù–ê–¢–¨ –†–û–õ–¨", callback_data="reveal_role"))
    bot.send_message(chat_id, f"üé≤ –ò–≥—Ä–æ–∫ ‚Ññ{data['current']}, —Ç–≤–æ–π —Ö–æ–¥!", reply_markup=markup)

@bot.callback_query_handler(func=lambda call: call.data == "reveal_role")
def reveal(call):
    chat_id = call.message.chat.id
    data = game_data[chat_id]
    
    if data["current"] == data["mafia_index"]:
        text = "üï∂ –¢–´ –ú–ê–§–ò–Ø!\n\n–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –Ω–µ —Å–ø–∞–ª–∏—Ç—å—Å—è –∏ —É–≥–∞–¥–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç –ø–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞–º –º–∏—Ä–Ω—ã—Ö."
    else:
        text = f"üé§ –¢–´ –ú–ò–†–ù–´–ô!\n\n–¢–µ–º–∞: {data['category']}\n–û–±—ä–µ–∫—Ç: {data['word']}\n–ò–Ω—Ñ–æ: {data['desc']}"
    
    markup = types.InlineKeyboardMarkup()
    markup.add(types.InlineKeyboardButton("‚ùå –°–ö–†–´–¢–¨", callback_data="next_player"))
    bot.edit_message_text(text, chat_id, call.message.message_id, reply_markup=markup)

@bot.callback_query_handler(func=lambda call: call.data == "next_player")
def next_p(call):
    chat_id = call.message.chat.id
    bot.delete_message(chat_id, call.message.message_id)
    
    if game_data[chat_id]["current"] < game_data[chat_id]["count"]:
        game_data[chat_id]["current"] += 1
        send_turn(chat_id)
    else:
        bot.send_message(chat_id, "üî• –í—Å–µ —Ä–æ–ª–∏ —Ä–æ–∑–¥–∞–Ω—ã!\n\n–ù–∞—á–∏–Ω–∞–π—Ç–µ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ. –ö—Ç–æ –º–∞—Ñ–∏—è?")
        del game_data[chat_id]

if name == "__main__":
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω!")
    bot.infinity_polling()
